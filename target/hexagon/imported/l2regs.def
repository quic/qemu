/*
 *  Copyright (c) 2019 Qualcomm Innovation Center, Inc. All Rights Reserved.
 *
 *  This program is free software; you can redistribute it and/or modify
 *  it under the terms of the GNU General Public License as published by
 *  the Free Software Foundation; either version 2 of the License, or
 *  (at your option) any later version.
 *
 *  This program is distributed in the hope that it will be useful,
 *  but WITHOUT ANY WARRANTY; without even the implied warranty of
 *  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 *  GNU General Public License for more details.
 *
 *  You should have received a copy of the GNU General Public License
 *  along with this program; if not, see <http://www.gnu.org/licenses/>.
 */

/*
 *
 * 
 * $Id$
 */


/* L2 registers are architected. Hence defined here. We need documentation,
   and information in iset. But an instance of this need NOT be in
   thread.h */

DEF_MMAP_REG(L2REG_QOS_MODE, "L2QOS Mode", "rl2qosmode", 1, BASE_L2_REGS+0x40)
DEF_MMAP_REG(L2REG_QOS_MAX_TRANS,"L2QOS Max AXI Transactions", "rl2qosmaxtrans", 1,BASE_L2_REGS+0x41)
DEF_MMAP_REG(L2REG_QOS_ISSUE_RATE,"L2QOS AXI Rate Control", "rl2qosissuerate", 1,BASE_L2_REGS+0x42)
DEF_MMAP_REG(L2REG_QOS_DANGER_ISSUE_RATE,"L2QOS AXI Danger Rate Control", "rl2qosmaxtrans", 1,BASE_L2_REGS+0x43)
DEF_MMAP_REG(L2REG_QOS_SB_WATERMARK,"L2QOS Watermark Control for AXI", "rl2qossbwmark", 1,BASE_L2_REGS+0x44)
DEF_MMAP_REG(L2REG_QOS_SYS_PRI,"L2QOS System Priority", "rl2qossyspri", 1,BASE_L2_REGS+0x45)
DEF_MMAP_REG(L2REG_QOS_DANGER0,"L2QOS Thread System Priority", "rl2qosdanger0", 1,BASE_L2_REGS+0x80)
DEF_MMAP_REG(L2REG_QOS_DANGER1,"L2QOS Thread System Priority", "rl2qosdanger1", 1,BASE_L2_REGS+0x100)
DEF_MMAP_REG(L2REG_QOS_DANGER2,"L2QOS Thread System Priority", "rl2qosdanger2", 1,BASE_L2_REGS+0x180)
DEF_MMAP_REG(L2REG_QOS_DANGER3,"L2QOS Thread System Priority", "rl2qosdanger3", 1,BASE_L2_REGS+0x200)

DEF_REG_FIELD(QOSMODE_NP,"np",0,2,"Selection policy between eligible high- and low-priority bus schedulers - 10: Round Robin, 11: Weighted Round Robin (3 times pick high, 4th time pick low)")
DEF_REG_FIELD(QOSMODE_DP,"dp",2,2,"Selection policy between eligible high- and low-priority bus schedulers, when danger is asserted. 01: Always pick high, 10: Round robin - alternate between high and low, 11: Weighted Round Robin ; 3 times pick high, 4th time pick low.")
DEF_REG_FIELD(QOSMODE_EP,"ep",4,2,"Selection policy between eligible high- and low-priority bus schedulers, when extreme danger is asserted. 01: Always pick high, 10: Round robin - alternate between high and low, 11: Weighted Round Robin ; 3 times pick high, 4th time pick low.")
DEF_REG_FIELD(QOSMODE_TL,"tl",7,1,"If set, apply scoreboard watermark low priority i.e. low-priority threads and L2Fetch engine both stalled when low-priority scoreboard threshold exceeded. When clear, no hard limit on scoreboard for low-priority threads, except when danger is present.")
DEF_REG_FIELD(QOSMODE_TH,"th",8,1,"If set, apply scoreboard watermark high priority i.e. low- and high-priority threads and L2Fetch engine all stalled when high-priority scoreboard threshold exceeded. When clear, no hard limit on scoreboard for high-priority threads.")
DEF_REG_FIELD(QOSMODE_TF,"tf",9,1,"If set, apply Scoreboard Watermark L2Fetch i.e. L2Fetch engine is stalled when L2Fetch priority scoreboard threshold is exceeded. When clear, no hard limit on scoreboard occupancy for L2Fetch engine.")
DEF_REG_FIELD(QOSMODE_DR,"dr",10,1,"If set, Danger Rate limit is applied to low-priority bus scheduler. Extreme Danger rate applied to both low- and high-priority bus schedulers.")
DEF_REG_FIELD(QOSMODE_DL,"dl",11,1,"If set, stall low-priority threads when danger is received and if above the low-priority scoreboard occupancy threshold.")
DEF_REG_FIELD(QOSMODE_DF,"df",12,1,"If set, stall L2Fetch when danger signal is set.")
DEF_REG_FIELD(QOSMODE_B,"b",13,1,"1: When a high-priority request must be sent to the bus, the priority is elevated to high-priority. The implementation should immediately elevate the external priority indication. 0: (Default) All requests are sent to bus with low-priority indication.")
DEF_REG_FIELD(QOSMODE_D,"d",14,1,"0: (Default) Deassert bus priority when all priority requests have been transfered by the AXI master, 1: Deassert bus priority when all priority requests have retired.")
DEF_REG_FIELD(QOSMODE_S,"s",15,1,"1: L2Fetch stalled when bus interface cannot accept non-priority request, 0: (Default) L2Fetch not stalled by issue FIFO")
DEF_REG_FIELD(QOSMODE_L,"l",16,1,"1: A thread stalls if it has too many outstanding requests that are likely to cause blocking conditions to TCM, the L2 cache, or the primary AXI bus. 0: (Default) No limits on the number of certain type of requests that a thread can make.")
DEF_REG_FIELD(QOSMODE_MT,"mt",17,1,"1: QOS_MAX_TRANS controls maximum transaction count. 0: (Default) No limit on number of bus transactions.")

DEF_REG_FIELD(QOSMAXTRANS_RD,"max_rd",0,8,"Maximum number of read requests that can be presented to AXI master. Default 1, Max 127.")
DEF_REG_FIELD(QOSMAXTRANS_NPRD,"max_nprd",8,8,"Maximum number of non-priority read requests that can be presented to AXI master. Default 1, Max 127.")
DEF_REG_FIELD(QOSMAXTRANS_WR,"max_wr",16,8,"Maximum number of write requests that can be presented to AXI master. Default 1, Max 127.")
DEF_REG_FIELD(QOSMAXTRANS_NPWR,"max_npwr",24,8,"Maximum number of non-priority write requests that can be presented to AXI master. Default 1, Max 127.")

DEF_REG_FIELD(QOSISSUERATE_RD,"max_issue_rd",0,8,"Maximum issue rate for read requests. Specifies the minimum number of idle clocks (i.e. MAX_IS_RD * 8) between read requests to AXI primary request FIFO. Range: 0 to 1016.")
DEF_REG_FIELD(QOSISSUERATE_WR,"max_issue_wr",8,8,"Maximum issue rate for write requests. Specifies the minimum number of idle clocks (i.e. MAX_IS_WR * 8) between write requests to AXI primary request FIFO. Range: 0 to 1016.") 
DEF_REG_FIELD(QOSISSUERATE_LOW,"max_issue_low",16,8,"Maximum issue rate for low-priority requests. Specifies the minimum number of idle clocks (i.e. MAX_IS_LO * 8) between low-priority requests to AXI primary request FIFO. Range: 0 to 1016. Applies to both read and write transactions.")

DEF_REG_FIELD(QOSDANGERISSUERATE_D,"max_issue_rate_danger",0,8,"Maximum issue rate for low-priority requests in danger. Specifies the minimum number of idle clocks (i.e. MAX_IS_D * 8) between low-priority requests to AXI primary request FIFO, when in danger and enabled. Range: 0 to 1016. Applies to both read and write transactions.")
DEF_REG_FIELD(QOSDANGERISSUERATE_ED,"max_issue_rate_extreme_danger",8,8,"Maximum issue rate for all requests in extreme danger. Specifies the minimum number of idle clocks (i.e. MAX_IS_XD * 8) between any request to AXI primary request FIFO, when in extreme danger and enabled. Range: 0 to 1016. Applies to both read and write transactions. For low-priority requests, both MAX_ISSUE_DANGER and MAX_ISSUE_EXTREME_DANGER are applied when in extreme danger.")

DEF_REG_FIELD(QOSSBWM_L2F,"wm_l2_fetch",0,8,"L2fetch watermark: when occupancy of scoreboard exceeds this value, requests from L2Fetch engine are stalled. For interleaved design, the watermark applies to the smaller scoreboard. Minimum value 0x1 specifies 2 transactions.")

DEF_REG_FIELD(QOSSBWM_LO,"wm_low_pri",8,8,"Low priority watermark: when occupancy of scoreboard exceeds this value, requests from low-priority threads are stalled at the source. Minimum value 0x1 specifies 2 transactions. Value must be at least 2 less than WM_HIGH_PRI. For interleaved design, the watermark applies to the smaller scoreboard.")

DEF_REG_FIELD(QOSSBWM_HI,"wm_high_pri",16,8,"High priority watermark: when occupancy of scoreboard exceeds this value, requests from high-priority threads are stalled at the source. Minimum value 0x1 specifies 2 transactions. Maximum value must not exceed the physical capacity of the L2 scoreboard. For interleaved design, the watermark applies to the smaller interleaved scoreboard.")

DEF_REG_FIELD(QOSSYSPRI_LO,"sys_pri_lo",0,8,"Value presented on QSB pins AREQPRIORITY[2:0] for low-priority indication.")
DEF_REG_FIELD(QOSSYSPRI_HI,"sys_pri_hi",8,8,"Value presented on QSB pins AREQPRIORITY[2:0] for high-priority indication.")

DEF_REG_FIELD(QOSDANGER0_LO,"Danger0",0,2,"For thread 0: Value presented to DSAT logic as two-bit danger field - 00=No danger, 01=Some danger, 10=More danger, 11=Extreme danger")
DEF_REG_FIELD(QOSDANGER0_PRI,"Priority0",16,2,"For thread 0: Value presented to DSAT logic as two-bit priority field (software-defined).")

DEF_REG_FIELD(QOSDANGER1_LO,"Danger1",0,2,"For thread 1: Value presented to DSAT logic as two-bit danger field - 00=No danger, 01=Some danger, 10=More danger, 11=Extreme danger")
DEF_REG_FIELD(QOSDANGER1_PRI,"Priority1",16,2,"For thread 1: Value presented to DSAT logic as two-bit priority field (software-defined).")

DEF_REG_FIELD(QOSDANGER2_LO,"Danger2",0,2,"For thread 2: Value presented to DSAT logic as two-bit danger field - 00=No danger, 01=Some danger, 10=More danger, 11=Extreme danger")
DEF_REG_FIELD(QOSDANGER2_PRI,"Priority2",16,2,"For thread 2: Value presented to DSAT logic as two-bit priority field (software-defined).")

DEF_REG_FIELD(QOSDANGER3_LO,"Danger3",0,2,"For thread 3: Value presented to DSAT logic as two-bit danger field - 00=No danger, 01=Some danger, 10=More danger, 11=Extreme danger")
DEF_REG_FIELD(QOSDANGER3_PRI,"Priority3",16,2,"For thread 3: Value presented to DSAT logic as two-bit priority field (software-defined).")

